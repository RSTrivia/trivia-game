<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leaderboard</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">

<script>
  // Apply saved background immediately
  const bg = localStorage.getItem("bg_current");
  if (bg) {
    const style = document.createElement("style");
    style.innerHTML = `body { background-image: url('${bg}') !important; background-size: cover; background-position: center; background-repeat: no-repeat; }`;
    document.head.appendChild(style);
  }
</script>

<style>
  body { margin:0; font-family: Arial,sans-serif; color:#fff; display:flex; justify-content:center; }
  .container { background-color: rgba(0,0,0,0.85); padding: 20px; border-radius: 10px; max-width: 900px; margin:20px; text-align:center; }
  h1 { font-family: 'Cinzel', serif; font-size:2.5rem; margin-bottom:25px; }
  #leaderboard { list-style:none; padding:0; margin:20px 0; }
  #leaderboard li { display:flex; justify-content:space-between; padding:10px 12px; border-radius:5px; margin-bottom:6px; background:rgba(50,50,50,0.8); }
  a.btn-small { display:inline-block; margin-top:10px; padding:10px 16px; color:#ffd700; border:2px solid #ffd700; border-radius:8px; text-decoration:none; transition:0.2s; }
  a.btn-small:hover { background: rgba(0,0,0,0.85); border-color:#ffea8a; }
</style>
</head>
<body>

<div class="container">
  <h1>Leaderboard</h1>
  <ul id="leaderboard"></ul>
  <a href="index.html" class="btn-small">Main Menu</a>
</div>

<script type="module">
import { supabase } from './supabase.js';
const leaderboardEl = document.getElementById('leaderboard');

function renderLeaderboard(data) {
  while(data.length < 10) data.push({username:'', score:null});
  leaderboardEl.innerHTML = '';
  data.forEach((entry,i)=>{
    const li=document.createElement('li');
    const left=document.createElement('span');
    const right=document.createElement('span');
    const posEmoji=i===0?'ðŸ¥‡':i===1?'ðŸ¥ˆ':i===2?'ðŸ¥‰':`${i+1}.`;
    left.textContent=entry.username?.trim()?`${posEmoji} ${entry.username}`:posEmoji;
    right.textContent=entry.score!=null?entry.score:'';
    li.appendChild(left);
    li.appendChild(right);
    leaderboardEl.appendChild(li);
  });
}

const preloaded = window.preloadedLeaderboard || null;
if(preloaded) renderLeaderboard(preloaded);
else {
  (async ()=>{
    const { data,error } = await supabase.from('public_leaderboard').select('username, score').order('score',{ascending:false}).limit(10);
    if(!error) renderLeaderboard(data||[]);
  })();
}
</script>

<script>
  // Mute button state (no button on leaderboard, optional: can add one if needed)
  let isMuted = localStorage.getItem('isMuted') === 'true';
</script>

</body>
</html>
